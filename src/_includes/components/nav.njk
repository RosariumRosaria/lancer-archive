{% macro renderNav(items) %}
  <ul class="nav-list">
    {% for item in items %}
      {% set isActive = (page.url == item.url) %}
      {% set isParent = (not isActive) and (page.url.indexOf(item.url) == 0) %}

      <li class="nav-item">
        <a
          class="nav-link{% if isActive %} is-active{% elseif isParent %} is-parent{% endif %}"
          href="{{ item.url }}"
          {% if isActive %}aria-current="page"{% endif %}
        >
          <span class="nav-label">{{ item.title or item.key }}</span>
        </a>

        {% if item.children and item.children.length %}
          {{ renderNav(item.children) }}
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endmacro %}

{% set nav = collections.all | eleventyNavigation %}

<nav class="nav" aria-label="Archive Directory">
  <div class="nav-header">
    <div class="nav-kicker">DIRECTORY</div>
    <div class="nav-title">ARCHIVE INDEX</div>
  </div>

  {{ renderNav(nav) }}
</nav>
