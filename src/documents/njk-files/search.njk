---
layout: layouts/base.njk
permalink: /search/
title: Search Terminal
---

<div class="card">
  {% sectionHeader "SEARCH TERMINAL" %}
  File Search
  {% endsectionHeader %}
  <hr>

<link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
<link href="/assets/css/pagefind-overrides.css" rel="stylesheet" />
<script src="/pagefind/pagefind-ui.js"></script>
<div id="search"></div>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    new PagefindUI({
      element: "#search",
      showSubResults: true
    });

    const gateResults = () => {
      const clearanceVal = Number(window.ArchiveAuth?.getSession?.()?.clearance);
      const maxClearance = Number.isFinite(clearanceVal) ? clearanceVal : 0;

      document.querySelectorAll(".pagefind-ui__result").forEach((result) => {
        const meta = result.querySelector('[data-pagefind-ui-meta="clearance"]');
        const match = meta?.textContent?.match(/:\s*(\d+)/);
        const clearance = match ? Number(match[1]) : 0;
        const shouldHide = Number.isFinite(clearance) && clearance > maxClearance;
        result.style.display = shouldHide ? "none" : "";
        if (meta) meta.style.display = "none";
      });
    };

    const observer = new MutationObserver(gateResults);
    const searchRoot = document.getElementById("search");
    if (searchRoot) {
      observer.observe(searchRoot, { childList: true, subtree: true });
    }
    gateResults();
  });
</script>

  <p class="smallprint">
    Note, this feature is experimental.
  </p>
</div>
