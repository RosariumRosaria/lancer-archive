---
layout: layouts/base.njk
permalink: /login/
title: Access Terminal
---

<div class="card">
  {% sectionHeader "ACCESS TERMINAL" %}
  Credential Entry
  {% endsectionHeader %}

  <h3>Authentication Required</h3>
  <p>Enter your assigned access code. All access attempts are logged.</p>
  <hr>

  <form id="access-form" novalidate>
    <div class="field">
      <label for="User Name" class="field-label">Codename</label>
      <input
        id="codename"
        class="field-input"
        type="text"
        autocomplete="one-time-code"
        autocapitalize="characters"
        spellcheck="false"
      >
    </div>

    <div class="field">
      <label for="access-code" class="field-label">Access Code</label>
      <input
        id="access-code"
        class="field-input"
        type="password"
        autocomplete="new-password"
        autocomplete="off"
        autocapitalize="off"
        spellcheck="false"
        required
      >
    </div>

    <div class="terminal-row">
      <button class="btn btn-primary" type="submit">Initiate Session</button>
      <a class="btn btn-ghost" href="/">Return to Index</a>
    </div>

    <p id="access-error" class="smallprint system-error" style="display:none;">
      ACCESS DENIED. VERIFY CREDENTIALS.
    </p>
  </form>

  <p class="smallprint">
    If you do not have credentials, contact your Oversight administrator for access.
  </p>
</div>

<script>
  const session = window.ArchiveAuth?.getSession?.();
  if (session && (session.clearance === 0 || session.clearance)) {
    window.location.href = "/";
  }

  const form = document.getElementById("access-form");
  const codeEl = document.getElementById("access-code");
  const codenameEl = document.getElementById("codename");
  const errEl = document.getElementById("access-error");

  function hideError() {
    errEl.style.display = "none";
  }

  codeEl.addEventListener("input", hideError);
  codenameEl.addEventListener("input", hideError);

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    hideError();

    const code = codeEl.value
      .normalize("NFKC")
      .replace(/\s+/g, "")
      .toUpperCase();

    const codename = codenameEl.value
      .normalize("NFKC")
      .trim()
      .toUpperCase();


    const record = window.ARCHIVE_ACCESS?.[code];
 
    if (!record) {
      errEl.style.display = "block";
      return;
    }

    const rec_user = record.user

  if (rec_user !== codename) {
        errEl.style.display = "block";
        console.log(rec_user)
        return;
      }


    const user = codename || record.user;

    window.ArchiveAuth.setSession(user, record.clearance);
    window.ArchiveAuth.applyHeaderBadge();
    window.location.href = "/";
  });
</script>
